!function(){"use strict";function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}let e=function(){function e(t,s,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.ERR_NOT_LOAD="Dictionary not loaded",this.ALPHABET="abcdefghijklmnopqrstuvwxyz",this.lDictionary="",this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=new Array,this.memoized={},this.loaded=!1,this.options=i||{asyncLoad:!1,flags:{}},null!=i&&void 0!==i.flags?this.flags=i.flags:this.flags={};const o=async t=>this._readFile(t,null,this.options.asyncLoad),r=async(t,e,s)=>{const n=t=>{e=t,s&&r()},i=t=>{s=t,e&&r()},r=()=>{if(void 0!==e&&void 0!==s){this.rules=this._parseAFF(e),this.compoundRuleCodes={};for(const t of this.compoundRules)if("string"==typeof t)for(let e=0;e<t.length;e++)this.compoundRuleCodes[t.charAt(e)]=[];this.flags.ONLYINCOMPOUND&&(this.compoundRuleCodes[this.flags.ONLYINCOMPOUND]=[]),this.dictionaryTable=this._parseDIC(s);for(const t in this.compoundRuleCodes)Object.prototype.hasOwnProperty.call(this.compoundRuleCodes,t)&&0===this.compoundRuleCodes[t].length&&delete this.compoundRuleCodes[t];u=0;for(const t of this.compoundRules){let e="";if("string"==typeof t){for(const s of t)s in this.compoundRuleCodes?e+="("+this.compoundRuleCodes[s].join("|")+")":e+=s;this.compoundRules[u]=new RegExp(e,"i"),u++}}this.loaded=!0,this.options.asyncLoad&&this.options.loadedCallback&&this.options.loadedCallback(this)}},l=()=>{var t,e;return"function"==typeof(null===(t=window.chrome)||void 0===t||null===(e=t.runtime)||void 0===e?void 0:e.getURL)};let a,c,h,u;if(t)if(this.lDictionary=t,e&&s)r();else if("undefined"==typeof window||!0!==l()&&"function"==typeof(null===(f=window.browser)||void 0===f||null===(d=f.runtime)||void 0===d?void 0:d.getURL)!=!0)a=this.options.dictionaryPath?this.options.dictionaryPath:"undefined"!=typeof __dirname?__dirname+"/dictionaries":"./dictionaries",!0===this.options.asyncLoad?(e||(c=o(a+"/"+t+"/"+t+".aff").then(t=>{n(t)})),s||(h=o(a+"/"+t+"/"+t+".dic").then(t=>{i(t)}))):(e||(c=await o(a+"/"+t+"/"+t+".aff").then(t=>{n(t)})),s||(h=await o(a+"/"+t+"/"+t+".dic").then(t=>{i(t)})));else{let r;a=this.options.dictionaryPath?this.options.dictionaryPath:"typo/dictionaries",r=!0===l()?window.chrome.runtime.getURL:window.browser.runtime.getURL,!0===this.options.asyncLoad?(e||(c=o(r(a+"/"+t+"/"+t+".aff")).then(t=>{n(t)})),s||(h=o(r(a+"/"+t+"/"+t+".dic")).then(t=>{i(t)}))):(e||(c=await o(r(a+"/"+t+"/"+t+".aff")).then(t=>{n(t)})),s||(h=await o(r(a+"/"+t+"/"+t+".dic")).then(t=>{i(t)})))}var f,d;return new Promise((t,e)=>{Promise.all([h,c]).then(()=>{t(!0)}).catch(()=>{e(!1)})})};this.ready=new Promise((e,i)=>{r(t,s,n).then(()=>{e(this)}).catch(i)})}var s,n,i;return s=e,(n=[{key:"load",value:function(t){for(const e in t)if(t.hasOwnProperty(e)&&Object(this).hasOwnProperty(e)){const s=t[e];Object.defineProperty(this,e.toString(),{value:s,writable:!0,enumerable:!0,configurable:!0})}return this}},{key:"_readFile",value:function(t,e,s=!1){if(e=e||"utf8","function"==typeof fetch){const n=new Headers;n.set("Content-Type","text/plain; charset="+e);const i=async t=>(await fetch(t,{method:"GET",headers:n})).text();return s?fetch(t,{method:"GET",headers:n}).then(t=>t.text()):i(t)}if("undefined"!=typeof XMLHttpRequest){const n=new XMLHttpRequest;if(n.open("GET",t,s),n.overrideMimeType&&n.overrideMimeType("text/plain; charset="+e),s){const t=new Promise((function(t,e){n.onload=function(){200===n.status?t(n.responseText):e(n.statusText)},n.onerror=function(){e(n.statusText)}}));return n.send(null),t}return n.send(null),Promise.resolve(n.responseText)}if("undefined"!=typeof require){const s=require("fs");let n="",i=null;try{s.existsSync(t)?n=s.readFileSync(t,e):console.log("Path "+t+" does not exist.")}catch(t){i=t}return null!==i?Promise.reject(i):Promise.resolve(n)}return Promise.reject(new Error("An Error occured getting dictionary"))}},{key:"_parseAFF",value:function(t){const e={};let s,n,i,o,r,l,a,c;const h=(t=this._removeAffixComments(t)).split(/\r?\n/);for(r=0,a=h.length;r<a;r++){s=h[r];const t=s.split(/\s+/),a=t[0];if("PFX"===a||"SFX"===a){const s=t[1],u=t[2];i=parseInt(t[3],10);const f=[];for(l=r+1,c=r+1+i;l<c;l++){n=h[l],o=n.split(/\s+/);const t=o[2],e=o[3].split("/");let s=e[0];"0"===s&&(s="");const i=this.parseRuleCodes(e[1]),r=o[4],c={};c.add=s,i.length>0&&(c.continuationClasses=i),"."!==r&&(c.match="SFX"===a?new RegExp(r+"$"):new RegExp("^"+r)),"0"!==t&&(c.remove="SFX"===a?new RegExp(t+"$"):new RegExp(t)),f.push(c)}e[s]={type:a,combineable:"Y"===u,entries:f},r+=i}else if("COMPOUNDRULE"===a){for(i=parseInt(t[1],10),l=r+1,c=r+1+i;l<c;l++)s=h[l],o=s.split(/\s+/),this.compoundRules.push(o[1]);r+=i}else"REP"===a?(o=s.split(/\s+/),3===o.length&&this.replacementTable.push([o[1],o[2]])):this.flags[a]=t[1]}return e}},{key:"_removeAffixComments",value:function(t){return t.replace(/^\s*#.*$/gm,"").replace(/^\s\s*/m,"").replace(/\s\s*$/m,"").replace(/\n{2,}/g,"\n").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}},{key:"_parseDIC",value:function(t){const e=(t=this._removeDicComments(t)).split(/\r?\n/),s={},n=(t,e)=>{if(s.hasOwnProperty(t)||(s[t]=null),e.length>0){let n=s[t];null==n&&(n=[],s[t]=n),n.push(e)}};for(let t=1;t<e.length;t++){const s=e[t];if(!s)continue;const i=s.split("/",2),o=i[0];if(i.length>1){const t=this.parseRuleCodes(i[1]);(!this.flags.NEEDAFFIX||this.flags.NEEDAFFIX&&-1===t.indexOf(this.flags.NEEDAFFIX))&&n(o,t);for(let e=0;e<t.length;e++){const s=t[e],i=this.rules[s];if(i){const s=this._applyRule(o,i);for(const o of s)if(n(o,[]),i.combineable)for(let s=e+1;s<t.length;s++){const e=t[s],r=this.rules[e];if(r&&r.combineable&&i.type!==r.type){const t=this._applyRule(o,r);for(const e of t)n(e,[])}}}s in this.compoundRuleCodes&&this.compoundRuleCodes[s].push(o)}}else n(o.trim(),[])}return s}},{key:"_removeDicComments",value:function(t){return t.replace(/^\t.*$/gm,"")}},{key:"_applyRule",value:function(t,e){const s=e.entries;let n=[];for(const i of s)if(!i.match||t.match(i.match)){let s=t;if(i.remove&&(s=s.replace(i.remove,"")),"SFX"===e.type?s+=i.add:s=i.add+s,n.push(s),"continuationClasses"in i)for(const t of i.continuationClasses)t&&(n=n.concat(this._applyRule(s,t)))}return n}},{key:"parseRuleCodes",value:function(t){if(!t||void 0===this.flags)return[];if(!this.flags.FLAG)return t.split("");if("long"===this.flags.FLAG){const e=[];for(let s=0;s<t.length;s+=2)e.push(t.substr(s,2));return e}return"num"===this.flags.FLAG?t.split(","):[]}},{key:"check",value:function(t){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(0===t.length)return!1;const e=t.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(e))return!0;if(e.toUpperCase()===e){const t=e[0]+e.substring(1).toLowerCase();if(this.hasFlag(t,"KEEPCASE"))return!1;if(this.checkExact(t))return!0}const s=e.toLowerCase();if(s!==e){if(this.hasFlag(s,"KEEPCASE"))return!1;if(this.checkExact(s))return!0}return!1}},{key:"checkExact",value:function(t){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(0===t.length)return!1;const e=this.dictionaryTable[t];if(void 0===e){if(this.flags.COMPOUNDMIN&&t.length>=this.flags.COMPOUNDMIN)for(const e of this.compoundRules)if(t.match(e))return!0}else{if(null===e)return!0;if("object"==typeof e)for(const s of e)if(null!==s&&!this.hasFlag(t,"ONLYINCOMPOUND",s))return!0}return!1}},{key:"hasFlag",value:function(t,e,s){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(e in this.flags){if(void 0===s){const e=this.dictionaryTable[t];s=null!=e?(t=>{const e=[];for(const s of t)for(const t of s)e.push(t);return e})(e):[]}if(s&&s.indexOf(this.flags[e])>=0)return!0}return!1}},{key:"suggest",value:function(t,e=5){if(!this.loaded)throw new Error(this.ERR_NOT_LOAD);if(this.memoized.hasOwnProperty(t)){const s=this.memoized[t].limit;if(e<=s||this.memoized[t].suggestions.length<s)return this.memoized[t].suggestions.slice(0,e)}if(this.check(t))return[];for(const e of this.replacementTable)if(-1!==t.indexOf(e[0])){const s=t.replace(e[0],e[1]);if(this.check(s))return[s]}const s=(t,e=!1)=>{const s={};let n,i,o,r,l;if("string"==typeof t){const e=t;(t={})[e]=1}for(const a in t)if(Object.prototype.hasOwnProperty.call(t,a))for(n=0,o=a.length+1;n<o;n++){const t=[a.substring(0,n),a.substring(n)];if(t[1]&&(l=t[0]+t[1].substring(1),e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1)),t[1].length>1&&t[1][1]!==t[1][0]&&(l=t[0]+t[1][1]+t[1][0]+t[1].substring(2),e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1)),t[1])for(i=0,r=this.ALPHABET.length;i<r;i++)this.ALPHABET[i]!==t[1].substring(0,1)&&(l=t[0]+this.ALPHABET[i]+t[1].substring(1),e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1));if(t[1])for(i=0,r=this.ALPHABET.length;i<r;i++)l=t[0]+this.ALPHABET[i]+t[1],e&&!this.check(l)||(l in s?s[l]+=1:s[l]=1)}return s};return this.memoized[t]={suggestions:(t=>{const n=s(t),i=s(n,!0);for(const t in n)this.check(t)&&(t in i?i[t]+=n[t]:i[t]=n[t]);let o;const r=[];for(const t in i)i.hasOwnProperty(t)&&r.push([t,i[t]]);r.sort((t,e)=>{const s=t[1],n=e[1];return s<n?-1:s>n?1:e[0].toString().localeCompare(t[0].toString())}).reverse();const l=[];let a="lowercase";t.toUpperCase()===t?a="uppercase":t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase()===t&&(a="capitalized");let c=e;for(o=0;o<Math.min(c,r.length);o++){let t=r[o][0].toString(),e=!1;"uppercase"===a?(t=t.toUpperCase(),e=!0):"capitalized"===a&&(t=t.substr(0,1).toUpperCase()+t.substr(1),e=!0),this.hasFlag(t,"NOSUGGEST")||-1!==l.indexOf(t)?c++:l.push(t),e&&(r[o][0]=t)}return l})(t),limit:e},this.memoized[t].suggestions}},{key:"Ready",get:function(){return this.ready}},{key:"dictionary",get:function(){return""===this.lDictionary?null:this.lDictionary}}])&&t(s.prototype,n),i&&t(s,i),e}();"undefined"!=typeof window&&void 0===window.Typo&&(window.Typo=e)}();